{
  "version": 3,
  "sources": ["../src/shared/debounce.ts", "../src/preload.ts", "../src/VelocityNative.ts"],
  "sourcesContent": ["/*\n * Velocity, a modification for Discord's desktop app\n * Copyright (c) 2025 Velocitcs and contributors\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\n/**\n * Returns a new function that will call the wrapped function\n * after the specified delay. If the function is called again\n * within the delay, the timer will be reset.\n * @param func The function to wrap\n * @param delay The delay in milliseconds\n */\nexport function debounce<T extends Function>(func: T, delay = 300): T {\n    let timeout: NodeJS.Timeout;\n    return function (...args: any[]) {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => { func(...args); }, delay);\n    } as any;\n}\n", "/*\n * Velocity, a modification for Discord's desktop app\n * Copyright (c) 2025 Velocitcs and contributors\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport { debounce } from \"@shared/debounce\";\nimport { contextBridge, webFrame } from \"electron\";\nimport { readFileSync, watch } from \"fs\";\nimport { join } from \"path\";\n\nimport VelocityNative from \"./VelocityNative\";\n\ncontextBridge.exposeInMainWorld(\"VelocityNative\", VelocityNative);\n\n// Discord\nif (location.protocol !== \"data:\") {\n    // #region cssInsert\n    const rendererCss = join(__dirname, IS_DISCORD_DESKTOP ? \"renderer.css\" : \"velocityDesktopRenderer.css\");\n    const style = document.createElement(\"style\");\n    style.id = \"velocity-css-core\";\n    style.textContent = readFileSync(rendererCss, \"utf-8\");\n\n    if (document.readyState === \"complete\") {\n        document.documentElement.appendChild(style);\n    } else {\n        document.addEventListener(\"DOMContentLoaded\", () => document.documentElement.appendChild(style), {\n            once: true\n        });\n    }\n\n    if (IS_DEV) {\n        // persistent means keep process running if watcher is the only thing still running\n        // which we obviously don't want\n        watch(rendererCss, { persistent: false }, () => {\n            document.getElementById(\"velocity-css-core\")!.textContent = readFileSync(rendererCss, \"utf-8\");\n        });\n    }\n    // #endregion\n\n    if (IS_DISCORD_DESKTOP) {\n        webFrame.executeJavaScript(readFileSync(join(__dirname, \"renderer.js\"), \"utf-8\"));\n        require(process.env.DISCORD_PRELOAD!);\n    }\n} // Monaco popout\nelse {\n    contextBridge.exposeInMainWorld(\"setCss\", debounce(VelocityNative.quickCss.set));\n    contextBridge.exposeInMainWorld(\"getCurrentCss\", VelocityNative.quickCss.get);\n    // shrug\n    contextBridge.exposeInMainWorld(\"getTheme\", () => \"vs-dark\");\n}\n", "/*\n * Velocity, a modification for Discord's desktop app\n * Copyright (c) 2025 Velocitcs and contributors\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n*/\n\nimport type { Settings } from \"@api/Settings\";\nimport type { CspRequestResult } from \"@main/csp/manager\";\nimport type { PluginIpcMappings } from \"@main/ipcPlugins\";\nimport type { UserThemeHeader } from \"@main/themes\";\nimport { IpcEvents } from \"@shared/IpcEvents\";\nimport type { IpcRes } from \"@utils/types\";\nimport { ipcRenderer } from \"electron\";\n\nfunction invoke<T = any>(event: IpcEvents, ...args: any[]) {\n    return ipcRenderer.invoke(event, ...args) as Promise<T>;\n}\n\nexport function sendSync<T = any>(event: IpcEvents, ...args: any[]) {\n    return ipcRenderer.sendSync(event, ...args) as T;\n}\n\nconst PluginHelpers = {} as Record<string, Record<string, (...args: any[]) => Promise<any>>>;\nconst pluginIpcMap = sendSync<PluginIpcMappings>(IpcEvents.GET_PLUGIN_IPC_METHOD_MAP);\n\nfor (const [plugin, methods] of Object.entries(pluginIpcMap)) {\n    const map = PluginHelpers[plugin] = {};\n    for (const [methodName, method] of Object.entries(methods)) {\n        map[methodName] = (...args: any[]) => invoke(method as IpcEvents, ...args);\n    }\n}\n\nexport default {\n    themes: {\n        uploadTheme: (fileName: string, fileData: string, velocityTheme: boolean) => invoke<void>(IpcEvents.UPLOAD_THEME, fileName, fileData, velocityTheme),\n        deleteTheme: (fileName: string) => invoke<void>(IpcEvents.DELETE_THEME, fileName),\n        getThemesList: () => invoke<Array<UserThemeHeader>>(IpcEvents.GET_THEMES_LIST),\n        getThemeData: (fileName: string, velocity?: boolean) => invoke<string | undefined>(IpcEvents.GET_THEME_DATA, fileName, velocity),\n        getVelocityThemes: () => invoke<string>(IpcEvents.GET_VELOCITY_THEMES),\n        getSystemValues: () => invoke<Record<string, string>>(IpcEvents.GET_THEME_SYSTEM_VALUES),\n\n        openFolder: () => invoke<void>(IpcEvents.OPEN_THEMES_FOLDER),\n    },\n\n    updater: {\n        getUpdates: () => invoke<IpcRes<Record<\"hash\" | \"author\" | \"message\", string>[]>>(IpcEvents.GET_UPDATES),\n        update: () => invoke<IpcRes<boolean>>(IpcEvents.UPDATE),\n        rebuild: () => invoke<IpcRes<boolean>>(IpcEvents.BUILD),\n        getRepo: () => invoke<IpcRes<string>>(IpcEvents.GET_REPO),\n    },\n\n    settings: {\n        get: () => sendSync<Settings>(IpcEvents.GET_SETTINGS),\n        set: (settings: Settings, pathToNotify?: string) => invoke<void>(IpcEvents.SET_SETTINGS, settings, pathToNotify),\n\n        openFolder: () => invoke<void>(IpcEvents.OPEN_SETTINGS_FOLDER),\n    },\n\n    quickCss: {\n        get: () => invoke<string>(IpcEvents.GET_QUICK_CSS),\n        set: (css: string) => invoke<void>(IpcEvents.SET_QUICK_CSS, css),\n\n        addChangeListener(cb: (newCss: string) => void) {\n            ipcRenderer.on(IpcEvents.QUICK_CSS_UPDATE, (_, css) => cb(css));\n        },\n\n        addThemeChangeListener(cb: () => void) {\n            ipcRenderer.on(IpcEvents.THEME_UPDATE, () => cb());\n        },\n\n        openFile: () => invoke<void>(IpcEvents.OPEN_QUICKCSS),\n        openEditor: () => invoke<void>(IpcEvents.OPEN_MONACO_EDITOR),\n        getEditorTheme: () => sendSync<string>(IpcEvents.GET_MONACO_THEME),\n    },\n\n    native: {\n        getVersions: () => process.versions as Partial<NodeJS.ProcessVersions>,\n        openExternal: (url: string) => invoke<void>(IpcEvents.OPEN_EXTERNAL, url),\n        getRendererCss: () => invoke<string>(IpcEvents.GET_RENDERER_CSS),\n        onRendererCssUpdate: (cb: (newCss: string) => void) => {\n            if (!IS_DEV) return;\n\n            ipcRenderer.on(IpcEvents.RENDERER_CSS_UPDATE, (_e, newCss: string) => cb(newCss));\n        }\n    },\n\n    csp: {\n        /**\n         * Note: Only supports full explicit matches, not wildcards.\n         *\n         * If `*.example.com` is allowed, `isDomainAllowed(\"https://sub.example.com\")` will return false.\n         */\n        isDomainAllowed: (url: string, directives: string[]) => invoke<boolean>(IpcEvents.CSP_IS_DOMAIN_ALLOWED, url, directives),\n        removeOverride: (url: string) => invoke<boolean>(IpcEvents.CSP_REMOVE_OVERRIDE, url),\n        requestAddOverride: (url: string, directives: string[], callerName: string) =>\n            invoke<CspRequestResult>(IpcEvents.CSP_REQUEST_ADD_OVERRIDE, url, directives, callerName),\n    },\n\n    pluginHelpers: PluginHelpers\n};\n"],
  "mappings": "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",
  "names": ["debounce", "func", "delay", "timeout", "args", "import_electron", "import_fs", "import_path", "import_electron", "invoke", "event", "args", "sendSync", "PluginHelpers", "pluginIpcMap", "plugin", "methods", "map", "methodName", "method", "VelocityNative_default", "fileName", "fileData", "velocityTheme", "velocity", "settings", "pathToNotify", "css", "cb", "_", "url", "directives", "callerName", "VelocityNative_default", "rendererCss", "style", "debounce"]
}
